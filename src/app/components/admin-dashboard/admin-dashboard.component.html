<!-- ✅ Fixed Logout Button -->
<div class="logout-container">
  <button (click)="logout()">Logout</button>
</div>

<div class="dashboard-container">
  <!-- Sidebar -->
  <div class="sidebar">
    <button (click)="setActiveSection('providers')">Service Providers</button>
    <button (click)="setActiveSection('feedbacks')">Feedbacks</button>
    <button (click)="setActiveSection('requests')">Service Requests</button>
  </div>

  <!-- Main Content -->
  <div class="content">
    <p *ngIf="message" class="message">{{ message }}</p>

    <!-- Service Providers Section -->
    <div *ngIf="activeSection === 'providers'">
      <h2>Service Providers</h2>

      <div class="filters">
        <input type="text" [(ngModel)]="providerNameFilter" placeholder="Filter by Name" (input)="filterProviders()" />
        <input type="text" [(ngModel)]="providerLocationFilter" placeholder="Filter by Location" (input)="filterProviders()" />
        <input type="text" [(ngModel)]="providerCategoryFilter" placeholder="Filter by Category" (input)="filterProviders()" />
      </div>

      <table border="1" cellspacing="0" cellpadding="8">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Mobile</th>
            <th>Email</th>
            <th>Category</th>
            <th>Gender</th>
            <th>Location</th>
            <th>Description</th>
            <th>Profile Picture</th>
            <th>Status</th>
            <th>Action</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="filteredProviders.length === 0">
            <td colspan="11">No data found.</td>
          </tr>
          <tr *ngFor="let provider of filteredProviders">
            <td>{{ provider.id }}</td>
            <td>{{ provider.firstName }} {{ provider.lastName }}</td>
            <td>{{ provider.mobileNumber }}</td>
            <td>{{ provider.email }}</td>
            <td>{{ provider.category }}</td>
            <td>{{ provider.gender }}</td>
            <td>{{ provider.location }}</td>
            <!-- ✅ Fixed description -->
            <td class="description-column" [title]="provider.description">
              {{ provider.description }}
            </td>
            <td>
              <img *ngIf="provider.profilePicture" [src]="'data:image/jpeg;base64,' + provider.profilePicture" width="120" height="120" />
            </td>
            <td>{{ provider.approved ? 'Approved' : provider.rejected ? 'Rejected' : 'Pending' }}</td>
            <td>
              <!-- Approve Button with loader -->
              <button class="btn"
                      [ngClass]="provider.approved ? 'btn-approved' : 'btn-approve'"
                      [disabled]="provider.approved || loadingProviderIds[provider.id]"
                      (click)="approve(provider.id)">
                <ng-container *ngIf="loadingProviderIds[provider.id]; else approveText">
                  <i class="fa fa-spinner fa-spin"></i> Processing...
                </ng-container>
                <ng-template #approveText>
                  {{ provider.approved ? 'Approved' : 'Approve' }}
                </ng-template>
              </button>

              <!-- Reject Button with loader -->
              <button class="btn"
                      [ngClass]="provider.rejected ? 'btn-rejected' : 'btn-reject'"
                      [disabled]="provider.rejected || loadingProviderIds[provider.id]"
                      (click)="reject(provider.id)">
                <ng-container *ngIf="loadingProviderIds[provider.id]; else rejectText">
                  <i class="fa fa-spinner fa-spin"></i> Processing...
                </ng-container>
                <ng-template #rejectText>
                  {{ provider.rejected ? 'Rejected' : 'Reject' }}
                </ng-template>
              </button>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Feedbacks Section -->
    <div *ngIf="activeSection === 'feedbacks'">
      <h2>Feedback List</h2>
      <table border="1" cellspacing="0" cellpadding="8">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Category</th>
            <th>Rating</th>
            <th>Message</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let fb of feedbacks">
            <td>{{ fb.id }}</td>
            <td>{{ fb.name }}</td>
            <td>{{ fb.email }}</td>
            <td>{{ fb.category }}</td>
            <td>
              <ng-container *ngFor="let star of getStars(fb.rating)">
                <i class="fa" [ngClass]="star ? 'fa-star' : 'fa-star-o'" style="color: gold;"></i>
              </ng-container>
            </td>
            <td>{{ fb.message }}</td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Service Requests Section -->
    <div *ngIf="activeSection === 'requests'">
      <h2>Raised Service Requests</h2>

      <div class="requests-filters">
        <input type="text" [(ngModel)]="requestLocationFilter" placeholder="Filter by Location" (input)="filterRequests()" />
        <input type="text" [(ngModel)]="requestCategoryFilter" placeholder="Filter by Category" (input)="filterRequests()" />
      </div>

      <table border="1" cellspacing="0" cellpadding="8">
        <thead>
          <tr>
            <th>ID</th>
            <th>Name</th>
            <th>Email</th>
            <th>Gender</th>
            <th>Mobile</th>
            <th>Category</th>
            <th>Location</th>
            <th>Query</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="filteredRequests.length === 0">
            <td colspan="8">No data found.</td>
          </tr>
          <tr *ngFor="let request of filteredRequests">
            <td>{{ request.id }}</td>
            <td>{{ request.name }} {{ request.surname }}</td>
            <td>{{ request.email }}</td>
            <td>{{ request.gender }}</td>
            <td>{{ request.contactNumber }}</td>
            <td>{{ request.category }}</td>
            <td>{{ request.location }}</td>
            <td>{{ request.query }}</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>